#cloud-config

# Sets default user
user:
  name: itsc
  shell: /bin/bash
  lock_passwd: false
  groups: [adm, dialout, cdrom, floppy, sudo, audio, dip, video, plugdev, users, netdev, docker]
  plain_text_passwd: changeme
  uid: 1000

# Package installation
apt:
  # configure Docker daemon to restart on any installation/upgrade
  debconf_selections:
    set1: |
      docker.io docker.io/restart boolean true
      wireshark-common wireshark-common/install-setuid boolean true
packages: [
  # For class use
  g++, git,
  # IMUNES install prerequisites
  tcl, tcllib, jq, tk, imagemagick, xterm, wireshark, socat,
  make, # required only for the installation
  docker.io
]

runcmd:
  # install IMUNES
- git clone https://github.com/jeffreyalanwang/imunes.git /opt/imunes_temp/
- cd /opt/imunes_temp
- sudo make install
- sudo imunes -p || true # probably won't work unless the system has been restarted since installing docker.io
  # clean up
- cd /
- rm -rf /opt/imunes_temp

  # include IMUNES templates in home directory
- git clone https://github.com/imunes/imunes-examples.git /opt/imunes-templates_temp
- su itsc -c 'cp -r /opt/imunes-templates_temp/ /home/itsc/imunes-templates'
  # clean up
- rm -rf /opt/imunes-templates_temp

  # ensure users have something to see when they test VS Code functionality
- su itsc -c 'echo "EXAMPLE BASH HISTORY" >> /home/itsc/.bash_history'
